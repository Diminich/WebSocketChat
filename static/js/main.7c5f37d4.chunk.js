(this.webpackJsonpchatwebsocet=this.webpackJsonpchatwebsocet||[]).push([[0],{103:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(20),s=n.n(c),o=(n(63),n(33)),u=n.n(o),i=n(8),l=n(4),p=n.n(l),m=n(13),f=n(38),d=n(23),h=n(55),E=n.n(h),_={socket:null,subscriber:function(e,t,n){var a,r,c;null===(a=this.socket)||void 0===a||a.on("init-messages-published",e),null===(r=this.socket)||void 0===r||r.on("new-message-sent",t),null===(c=this.socket)||void 0===c||c.on("user-typing",n)},createConnection:function(){console.log("init"),this.socket=E()("https://samurai-chat-back.herokuapp.com")},destroyConnection:function(){var e;null===(e=this.socket)||void 0===e||e.disconnect(),this.socket=null},sendName:function(e){var t;null===(t=this.socket)||void 0===t||t.emit("client-name-sent",e)},sendMessage:function(e){var t;null===(t=this.socket)||void 0===t||t.emit("client-message-sent",e)},typeMessage:function(){var e;null===(e=this.socket)||void 0===e||e.emit("client-typed")}},b={messages:[],typingUsers:[]},g=function(e){return{type:"MESSAGES_RECEIVED",messages:e}},v=function(e){return{type:"NEW_MESSAGES_RECEIVED",message:e}},w=function(e){return{type:"TYPING_USERS_ADDED",user:e}},N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"MESSAGES_RECEIVED":return Object(d.a)({},e,{messages:t.messages});case"NEW_MESSAGES_RECEIVED":return Object(d.a)({},e,{messages:[].concat(Object(f.a)(e.messages),[t.message]),typingUsers:e.typingUsers.filter((function(e){return e.id!==t.message.user.id}))});case"TYPING_USERS_ADDED":return Object(d.a)({},e,{typingUsers:[].concat(Object(f.a)(e.typingUsers.filter((function(e){return e.id!==t.user.id}))),[t.user])});default:return e}},O=n(5),j=n(9),y=n.n(j),C=n(7),x=function(){var e=Object(a.useState)(""),t=Object(i.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)(!1),o=Object(i.a)(s,2),u=o[0],l=o[1],f=Object(O.b)();return r.a.createElement("nav",{className:y.a.nameInputButton},r.a.createElement("div",{className:y.a.inputNameError},r.a.createElement("input",{value:n,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043c\u044f",className:u?y.a.errorInputName:y.a.normalInputName,onChange:function(e){c(e.currentTarget.value),""===e.currentTarget.value?l(!0):l(!1)}}),u&&r.a.createElement("span",{className:y.a.errorOutput},"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043c\u044f!")),r.a.createElement(C.b,{to:"/Chat"},r.a.createElement("button",{className:y.a.button,disabled:n.length<1,onClick:function(){f(function(e){return function(){var t=Object(m.a)(p.a.mark((function t(n){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:_.sendName(e);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(n))}},"Sent name")))},k=n(6),S=n.n(k),I=r.a.memo((function(){var e=Object(a.useState)(""),t=Object(i.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)(!1),o=Object(i.a)(s,2),u=o[0],l=o[1],f=Object(a.useState)(0),d=Object(i.a)(f,2),h=d[0],E=d[1],b=Object(a.useRef)(null),g=Object(O.b)(),v=Object(O.c)((function(e){return e.chatPage.messages})),w=Object(O.c)((function(e){return e.chatPage.typingUsers}));Object(a.useEffect)((function(){var e;u&&(null===(e=b.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))}),[v]);var N=function(e){"Enter"===e.key&&""!==n.trim()&&(g(function(e){return function(){var t=Object(m.a)(p.a.mark((function t(n){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:_.sendMessage(e);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(n)),e.preventDefault(),c(""))};return r.a.createElement("nav",{className:S.a.wrapperChat},r.a.createElement("div",{className:S.a.windowMessages,onScroll:function(e){var t=e.currentTarget,n=t.scrollHeight-t.clientHeight;t.scrollTop>h&&Math.abs(n-t.scrollTop)<10?l(!0):l(!1),E(t.scrollTop)}},v.map((function(e){return r.a.createElement("div",{className:S.a.renderingCustomMessages,key:e.id},r.a.createElement("b",{style:{marginLeft:5}},e.user.name,": "),e.message)})),w.map((function(e){return r.a.createElement("div",{key:e.id},r.a.createElement("b",null,e.name,":")," ...")})),r.a.createElement("div",{ref:b})),r.a.createElement("div",{className:S.a.wrapperTextareaButtons},r.a.createElement("div",{className:S.a.wrapperTextarea},r.a.createElement("textarea",{value:n,className:S.a.textareaMessage,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",onKeyPress:function(e){g(function(){var e=Object(m.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_.typeMessage();case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),N(e)},onChange:function(e){c(e.currentTarget.value)}})),r.a.createElement(C.b,{className:S.a.exitButton,to:"/"},"Exit")))})),M=n(1),T=function(){var e=Object(O.b)();return Object(a.useEffect)((function(){return e(function(){var e=Object(m.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_.createConnection(),_.subscriber((function(e,n){t(g(e)),n("data from front")}),(function(e){t(v(e))}),(function(e){t(w(e))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),function(){e(function(){var e=Object(m.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_.destroyConnection();case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}),[]),r.a.createElement("div",{className:u.a.wrapperApp},r.a.createElement(M.c,null,r.a.createElement(M.a,{exact:!0,path:"/",render:function(){return r.a.createElement(x,null)}}),r.a.createElement(M.a,{exact:!0,path:"/Chat",render:function(){return r.a.createElement(I,null)}}),r.a.createElement(M.a,{render:function(){return r.a.createElement("div",{className:u.a.notFound},"404 NOT FOUND")}})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var A=n(12),D=n(57),B=Object(A.c)({chatPage:N}),R=Object(A.d)(B,Object(A.a)(D.a));s.a.render(r.a.createElement(C.a,null,r.a.createElement(O.a,{store:R},r.a.createElement(r.a.StrictMode,null,r.a.createElement(T,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},33:function(e,t,n){e.exports={wrapperApp:"App_wrapperApp__4_LHs",app:"App_app__37H77",notFound:"App_notFound__3RV7n"}},58:function(e,t,n){e.exports=n(103)},6:function(e,t,n){e.exports={wrapperChat:"Chat_wrapperChat__2Hp2W",windowMessages:"Chat_windowMessages__3jjbc",renderingCustomMessages:"Chat_renderingCustomMessages__AmRBT",wrapperTextareaButtons:"Chat_wrapperTextareaButtons__3tTUT",wrapperTextarea:"Chat_wrapperTextarea__22R59",textareaMessage:"Chat_textareaMessage__iOiZF",exitButton:"Chat_exitButton__3uwwW"}},63:function(e,t,n){},9:function(e,t,n){e.exports={nameInputButton:"NameInput_nameInputButton__3QR2S",inputNameError:"NameInput_inputNameError__3riJr",normalInputName:"NameInput_normalInputName__VbNCC",errorInputName:"NameInput_errorInputName__NDHmI",errorOutput:"NameInput_errorOutput__2NRxL",button:"NameInput_button__258bm"}},95:function(e,t){}},[[58,1,2]]]);
//# sourceMappingURL=main.7c5f37d4.chunk.js.map